代码加密流程

1. 开发人员提交代码
2. 代码库hook触发更新，更新临时加密用目录。
3. 监控程序inotify发现文件变化，触发处理过程：
	3.1. 如果是新增文件，执行svn add，逐级add
	3.2. 如果是修改文件，执行svn ci，同时指定提交者的名称，说明信息，原始版本号
	3.3. 如果是删除文件，执行svn delete
	如果操作不是删除，那么进行文件处理，php进行加密，js进行混淆
4. 其它部署检出加密代码


这样的问题：
1、通过inotify检测，无法获知对应文件的修改信息，如原始版本，提交者和提交信息。


方案3

1、通过svn hook，将vers,user,message,changelist（action+file）记录下来。
2、通过php或shell从记录中读取信息进行处理：新增，更新，删除，提交。
3、在处理过程中加密或混淆源码文件。

上面甚至可以不用svn hook，改为定时获取更新也可以。

有一个问题：不及时

svn hook，也可以考虑不用，做一个完全独立的系统，不干预原有库的运行。

使用svn log替换svn hook。

命令：

svn log Top -r 2 -v --xml

方案3修正

参考图吧


重要的两条命令：

svn log Top -r 2 -v --xml

svn ci -m 'test' --username=micate@9466.com


线上如何管理：

1、使用SVN更新。
2、有线上系统可以看到最近的更新。
3、有线上控制可以选择更新代码到哪个版本。
4、发现问题时，可以记录哪个版本的问题。可以回滚到某个版本。
5、可以线上创建版本（管理）虽然SVN更新很多，但不是任何一个时刻都是可用的版本。
6、可以对一个版本进行记录和备注，更新到，回滚到。
7、代码更新只是一方面，还有数据库更新呢？服务更新呢？
8、所以。。。

决定

先不做了

先做好同步的代码加密控制。

线上的，手工svn up吧，一切ok。

-------------

